<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>CatÃ¡logo de Gorras</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <style>
    :root{
      --bg:#f6f7f9;
      --card:#ffffff;
      --text:#0b0f17;
      --muted:#667085;
      --line:#eaecf0;
      --accent:#111111;
      --accent2:#e63946;
      --radius:16px;
      --shadow: 0 10px 30px rgba(16,24,40,.08);
      --shadow2: 0 8px 20px rgba(16,24,40,.10);
      --max:1200px;
    }

    *{ box-sizing:border-box; }

    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background: var(--bg);
      color: var(--text);
    }

    /* ===== Top bar ===== */
    .topbar{
      position: sticky;
      top:0;
      z-index: 10;
      background: rgba(255,255,255,.85);
      backdrop-filter: blur(10px);
      border-bottom: 1px solid var(--line);
    }

    .topbar-inner{
      max-width: var(--max);
      margin: 0 auto;
      padding: 14px 16px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 12px;
    }

    .brand{
      display:flex;
      align-items:center;
      gap:10px;
      text-decoration:none;
      color:inherit;
    }

    .logo{
      width:38px;
      height:38px;
      border-radius: 12px;
      background: linear-gradient(135deg, #111 0%, #333 100%);
      display:grid;
      place-items:center;
      color:#fff;
      font-weight:800;
      letter-spacing:.5px;
      box-shadow: 0 6px 18px rgba(0,0,0,.15);
    }

    .brand h1{
      font-size: 15px;
      margin:0;
      letter-spacing:.2px;
      font-weight: 800;
      text-transform: uppercase;
    }

    .brand span{
      display:block;
      font-size:12px;
      color: var(--muted);
      font-weight:600;
      text-transform:none;
      letter-spacing:0;
      margin-top:2px;
    }

    .tools{
      display:flex;
      align-items:center;
      gap:10px;
      width: min(520px, 55vw);
      justify-content:flex-end;
    }

    .search{
      flex: 1 1 auto;
      display:flex;
      align-items:center;
      gap:10px;
      padding: 10px 12px;
      border: 1px solid var(--line);
      border-radius: 999px;
      background:#fff;
      box-shadow: 0 4px 14px rgba(16,24,40,.05);
    }

    .search input{
      width:100%;
      border:none;
      outline:none;
      font-size: 14px;
      color: var(--text);
    }

    .pill{
      border: 1px solid var(--line);
      background:#fff;
      border-radius: 999px;
      padding: 10px 12px;
      font-size: 13px;
      color: var(--text);
      font-weight:700;
      cursor:pointer;
      transition: transform .12s ease, box-shadow .12s ease;
      box-shadow: 0 4px 14px rgba(16,24,40,.05);
    }
    .pill:hover{ transform: translateY(-1px); box-shadow: 0 10px 22px rgba(16,24,40,.08); }

    /* ===== Hero ===== */
    .hero{
      max-width: var(--max);
      margin: 0 auto;
      padding: 18px 16px 8px;
      display:flex;
      align-items:flex-end;
      justify-content:space-between;
      gap: 16px;
    }

    .hero h2{
      margin:0;
      font-size: 26px;
      letter-spacing:-.6px;
    }
    .hero p{
      margin:6px 0 0;
      color: var(--muted);
      font-weight:600;
    }

    .hero-right{
      display:flex;
      gap:10px;
      align-items:center;
      flex-wrap:wrap;
      justify-content:flex-end;
    }

    .chip{
      font-size:12px;
      font-weight:800;
      border: 1px solid var(--line);
      background:#fff;
      border-radius: 999px;
      padding: 8px 10px;
      color: #111;
    }

    /* ===== Grid ===== */
    .wrap{
      max-width: var(--max);
      margin: 0 auto;
      padding: 14px 16px 40px;
    }

    .catalogo{
      display:grid;
      grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));
      gap: 18px;
      align-items:stretch;
    }

    .card{
      background: var(--card);
      border-radius: var(--radius);
      overflow:hidden;
      box-shadow: var(--shadow);
      border: 1px solid rgba(234,236,240,.9);
      display:flex;
      flex-direction:column;
      transition: transform .18s ease, box-shadow .18s ease;
    }
    .card:hover{
      transform: translateY(-3px);
      box-shadow: var(--shadow2);
    }

    .carousel{
      position:relative;
      width:100%;
      height: 230px;
      overflow:hidden;
      flex: 0 0 230px;
      background:#eef2f6;
    }

    .carousel img{
      width:100%;
      height: 230px;
      object-fit: cover;
      display:none;
    }
    .carousel img.active{ display:block; }

    .carousel button{
      position:absolute;
      top:50%;
      transform:translateY(-50%);
      background: rgba(17,17,17,.55);
      color:#fff;
      border:none;
      width: 36px;
      height: 36px;
      cursor:pointer;
      border-radius: 999px;
      z-index:2;
      display:grid;
      place-items:center;
      transition: background .12s ease, transform .12s ease;
    }
    .carousel button:hover{
      background: rgba(17,17,17,.75);
      transform: translateY(-50%) scale(1.03);
    }
    .prev{ left: 10px; }
    .next{ right: 10px; }

    .info{
      padding: 14px 14px 16px;
      display:flex;
      flex-direction:column;
      gap: 10px;
    }

    .topline{
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap: 10px;
    }

    .info h3{
      margin:0;
      font-size: 14px;
      line-height: 1.25;
      letter-spacing:.1px;
      font-weight: 850;
      text-transform: uppercase;
    }

    .precio{
      color: var(--accent2);
      font-weight: 900;
      white-space:nowrap;
      font-size: 14px;
    }

    .meta{
      display:flex;
      gap: 8px;
      flex-wrap:wrap;
      margin-top: -2px;
    }

    .tag{
      font-size: 11px;
      font-weight: 800;
      color: #111;
      background: #f2f4f7;
      border: 1px solid var(--line);
      border-radius: 999px;
      padding: 6px 8px;
    }

    .actions{
      display:flex;
      gap:10px;
      margin-top: 4px;
    }

    .btn{
      flex:1 1 auto;
      border:none;
      border-radius: 12px;
      padding: 11px 12px;
      cursor:pointer;
      font-weight: 900;
      letter-spacing:.2px;
      transition: transform .12s ease, opacity .12s ease, box-shadow .12s ease;
      display:flex;
      align-items:center;
      justify-content:center;
      gap: 8px;
      text-decoration:none;
      user-select:none;
    }

    .btn:active{ transform: scale(.99); }
    .btn-primary{
      background: var(--accent);
      color:#fff;
      box-shadow: 0 10px 22px rgba(17,17,17,.18);
    }
    .btn-primary:hover{ opacity: .95; }

    .btn-outline{
      background:#fff;
      color:#111;
      border: 1px solid var(--line);
    }
    .btn-outline:hover{ box-shadow: 0 10px 22px rgba(16,24,40,.08); transform: translateY(-1px); }

    .footer-actions{
      display:flex;
      justify-content:center;
      padding: 18px 0 0;
    }

    .loadmore{
      min-width: 220px;
    }

    /* ===== Responsive tweaks ===== */
    @media (max-width: 720px){
      .tools{ width: 56vw; }
      .hero{ align-items:flex-start; flex-direction:column; }
      .hero-right{ justify-content:flex-start; }
    }
  </style>
</head>

<body>
  <!-- TOPBAR -->
  <div class="topbar">
    <div class="topbar-inner">
      <a class="brand" href="#">
        <div class="logo">G</div>
        <div>
          <h1>Gorras</h1>
          <span>CatÃ¡logo oficial</span>
        </div>
      </a>

      <div class="tools">
        <div class="search" title="Buscar por nombre">
          ðŸ”Ž
          <input id="searchInput" type="text" placeholder="Buscar gorras..." />
        </div>
        <button class="pill" id="resetBtn" type="button">Reset</button>
      </div>
    </div>
  </div>

  <!-- HERO -->
  <div class="hero">
    <div>
      <h2>Explora el catÃ¡logo</h2>
      <p>Compra directo por WhatsApp. ImÃ¡genes desde Drive (IDs en Sheets).</p>
    </div>
    <div class="hero-right">
      <span class="chip" id="countChip">0 productos</span>
      <span class="chip">EnvÃ­os ðŸ‡¨ðŸ‡´</span>
      <span class="chip">Pago contraentrega (segÃºn ciudad)</span>
    </div>
  </div>

  <div class="wrap">
    <div class="catalogo" id="catalogo"></div>

    <div class="footer-actions">
      <button class="btn btn-outline loadmore" id="loadMoreBtn" type="button">
        Ver mÃ¡s
      </button>
    </div>
  </div>

  <script>
    // ðŸ”— CONFIGURA TU SHEET
    const SHEET_ID = "1zzLV5JfDDzFJb6IkmEB_yrpz0p2d7TfTD5MppYi2tnY";
    const SHEET_NAME = "Hoja1";
    const JSON_URL = `https://opensheet.elk.sh/${SHEET_ID}/${SHEET_NAME}`;

    // WhatsApp
    const WHATSAPP_NUMBER = "573124124008"; // +57 312 412 4008 (sin + ni espacios)
    const whatsappLink = (text) =>
      `https://wa.me/${WHATSAPP_NUMBER}?text=${encodeURIComponent(text)}`;

    // Drive ID -> imagen
    function idToDriveImage(id) {
      return `https://lh3.googleusercontent.com/d/${id}`;
    }

    // Formatea precio si viene como nÃºmero (opcional)
    function formatPrice(value) {
      if (!value) return "";
      const raw = String(value).trim();
      // si ya viene con $ o letras, no tocamos
      if (/[a-zA-Z$]/.test(raw)) return raw;
      const num = Number(raw.replaceAll(".", "").replaceAll(",", "."));
      if (!Number.isFinite(num)) return raw;
      return num.toLocaleString("es-CO", { style: "currency", currency: "COP", maximumFractionDigits: 0 });
    }

    let productos = [];
    let filtered = [];
    let index = 0;
    const batchSize = 8;
    let isLoading = false;

    const contenedor = document.getElementById("catalogo");
    const loadMoreBtn = document.getElementById("loadMoreBtn");
    const searchInput = document.getElementById("searchInput");
    const resetBtn = document.getElementById("resetBtn");
    const countChip = document.getElementById("countChip");

    fetch(JSON_URL)
      .then(res => res.json())
      .then(data => {
        productos = data.map(p => ({
          nombre: (p.nombre || "Sin nombre").trim(),
          precio: formatPrice(p.precio || ""),
          imagenes: (p.imagenes || "")
            .split("|")
            .map(x => x.trim())
            .filter(x => x.length > 0)
            .map(id => idToDriveImage(id)),
        }));

        filtered = [...productos];
        updateCount();
        resetRender();
        asegurarScroll();
      })
      .catch(err => console.error("Error cargando JSON:", err));

    function updateCount(){
      countChip.textContent = `${filtered.length} producto${filtered.length === 1 ? "" : "s"}`;
    }

    function resetRender(){
      contenedor.innerHTML = "";
      index = 0;
      cargarMas();
    }

    function cargarMas() {
      if (isLoading) return;
      isLoading = true;

      for (let i = 0; i < batchSize && index < filtered.length; i++, index++) {
        const p = filtered[index];

        const card = document.createElement("div");
        card.className = "card";

        /* ===== CARRUSEL ===== */
        const carousel = document.createElement("div");
        carousel.className = "carousel";

        const imgsToRender = p.imagenes.length
          ? p.imagenes
          : ["https://via.placeholder.com/800x600?text=Sin+imagen"];

        imgsToRender.forEach((imgUrl, i) => {
          const img = document.createElement("img");
          img.src = imgUrl;
          img.loading = "lazy";
          if (i === 0) img.classList.add("active");
          carousel.appendChild(img);
        });

        let current = 0;
        const getImgs = () => carousel.querySelectorAll("img");

        if (imgsToRender.length > 1) {
          const prev = document.createElement("button");
          prev.className = "prev";
          prev.type = "button";
          prev.textContent = "â€¹";
          prev.onclick = () => {
            const imgs = getImgs();
            imgs[current].classList.remove("active");
            current = (current - 1 + imgs.length) % imgs.length;
            imgs[current].classList.add("active");
          };

          const next = document.createElement("button");
          next.className = "next";
          next.type = "button";
          next.textContent = "â€º";
          next.onclick = () => {
            const imgs = getImgs();
            imgs[current].classList.remove("active");
            current = (current + 1) % imgs.length;
            imgs[current].classList.add("active");
          };

          carousel.appendChild(prev);
          carousel.appendChild(next);
        }

        card.appendChild(carousel);

        /* ===== INFO ===== */
        const info = document.createElement("div");
        info.className = "info";

        const topline = document.createElement("div");
        topline.className = "topline";

        const h3 = document.createElement("h3");
        h3.textContent = p.nombre;

        const precio = document.createElement("div");
        precio.className = "precio";
        precio.textContent = p.precio;

        topline.appendChild(h3);
        topline.appendChild(precio);

        const meta = document.createElement("div");
        meta.className = "meta";

        // Tags simples (puedes cambiarlos o sacarlos)
        const t1 = document.createElement("span");
        t1.className = "tag";
        t1.textContent = "Original";

        const t2 = document.createElement("span");
        t2.className = "tag";
        t2.textContent = "Nueva colecciÃ³n";

        meta.appendChild(t1);
        meta.appendChild(t2);

        const actions = document.createElement("div");
        actions.className = "actions";

        // âœ… BOTÃ“N COMPRAR (WhatsApp)
        const buy = document.createElement("a");
        buy.className = "btn btn-primary";
        buy.href = whatsappLink(`Hola! Quiero comprar esta gorra:\n\nâ€¢ ${p.nombre}\nâ€¢ Precio: ${p.precio || "N/A"}\n\nÂ¿Me confirmas disponibilidad y envÃ­o?`);
        buy.target = "_blank";
        buy.rel = "noopener";
        buy.textContent = "Comprar por WhatsApp";

        // BotÃ³n secundario (opcional): compartir link (si estÃ¡ en hosting)
        const share = document.createElement("button");
        share.className = "btn btn-outline";
        share.type = "button";
        share.textContent = "Copiar info";
        share.onclick = async () => {
          const text = `${p.nombre} - ${p.precio || ""}`.trim();
          try{
            await navigator.clipboard.writeText(text);
            share.textContent = "Copiado âœ…";
            setTimeout(()=> share.textContent = "Copiar info", 1200);
          }catch(e){
            alert("No se pudo copiar.");
          }
        };

        actions.appendChild(buy);
        actions.appendChild(share);

        info.appendChild(topline);
        info.appendChild(meta);
        info.appendChild(actions);

        card.appendChild(info);
        contenedor.appendChild(card);
      }

      isLoading = false;

      // Oculta "Ver mÃ¡s" si ya no hay mÃ¡s
      loadMoreBtn.style.display = (index >= filtered.length) ? "none" : "inline-flex";
    }

    function asegurarScroll() {
      while (index < filtered.length && document.body.scrollHeight <= window.innerHeight) {
        cargarMas();
      }
    }

    // Scroll infinito
    window.addEventListener("scroll", () => {
      if (window.innerHeight + window.scrollY >= document.body.offsetHeight - 200) {
        cargarMas();
      }
    });

    // BotÃ³n "Ver mÃ¡s"
    loadMoreBtn.addEventListener("click", () => cargarMas());

    // Buscar
    function applySearch(){
      const q = (searchInput.value || "").trim().toLowerCase();
      filtered = q
        ? productos.filter(p => (p.nombre || "").toLowerCase().includes(q))
        : [...productos];

      updateCount();
      resetRender();
      asegurarScroll();
    }

    let t = null;
    searchInput.addEventListener("input", () => {
      clearTimeout(t);
      t = setTimeout(applySearch, 150);
    });

    resetBtn.addEventListener("click", () => {
      searchInput.value = "";
      applySearch();
      window.scrollTo({ top: 0, behavior: "smooth" });
    });
  </script>
</body>
</html>
