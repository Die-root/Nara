<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>NAra</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <style>
    :root{
      --bg:#f6f7f9;
      --card:#ffffff;
      --text:#0b0f17;
      --muted:#667085;
      --line:#eaecf0;
      --accent:#111111;
      --accent2:#e63946;
      --radius:16px;
      --shadow: 0 10px 30px rgba(16,24,40,.08);
      --shadow2: 0 8px 20px rgba(16,24,40,.10);
      --max:1200px;
    }

    *{ box-sizing:border-box; }

    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background: var(--bg);
      color: var(--text);
    }

    /* ===== Top bar ===== */
    .topbar{
      position: sticky;
      top:0;
      z-index: 10;
      background: rgba(255,255,255,.85);
      backdrop-filter: blur(10px);
      border-bottom: 1px solid var(--line);
    }

    .topbar-inner{
      max-width: var(--max);
      margin: 0 auto;
      padding: 14px 16px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 12px;
    }

    .brand{
      display:flex;
      align-items:center;
      gap:10px;
      text-decoration:none;
      color:inherit;
    }

    /* ‚úÖ LOGO M√ÅS GRANDE */
    .logo{
    width:73px;           /* 30% m√°s grande */
    height:73px;          /* 30% m√°s grande */
    border-radius: 16px;
    background: none;     /* ‚ùå quitamos fondo */
    box-shadow: none;     /* ‚ùå quitamos delineado/sombra */
    display:grid;
    place-items:center;
    overflow:hidden;
    flex: 0 0 auto;
    }
    .logo img{
      width:100%;
      height:100%;
      object-fit:cover;
      display:block;
    }

    .brand h1{
      font-size: 15px;
      margin:0;
      letter-spacing:.2px;
      font-weight: 800;
      text-transform: uppercase;
    }

    .brand span{
      display:block;
      font-size:12px;
      color: var(--muted);
      font-weight:600;
      margin-top:2px;
    }

    .tools{
      display:flex;
      align-items:center;
      gap:10px;
      width: min(520px, 55vw);
      justify-content:flex-end;
    }

    .search{
      flex: 1 1 auto;
      display:flex;
      align-items:center;
      gap:10px;
      padding: 10px 12px;
      border: 1px solid var(--line);
      border-radius: 999px;
      background:#fff;
      box-shadow: 0 4px 14px rgba(16,24,40,.05);
    }

    /* ‚úÖ √çCONO PNG EN VEZ DE EMOJI */
    .search-icon{
      width:18px;
      height:18px;
      object-fit:contain;
      display:block;
      opacity:.9;
      user-select:none;
      -webkit-user-drag:none;
    }

    .search input{
      width:100%;
      border:none;
      outline:none;
      font-size: 14px;
      color: var(--text);
    }

    /* ===== Hero ===== */
    .hero{
      max-width: var(--max);
      margin: 0 auto;
      padding: 18px 16px 8px;
      display:flex;
      align-items:flex-end;
      justify-content:space-between;
      gap: 16px;
    }

    .hero h2{
      margin:0;
      font-size: 26px;
      letter-spacing:-.6px;
    }
    .hero p{
      margin:6px 0 0;
      color: var(--muted);
      font-weight:600;
    }

    .hero-right{
      display:flex;
      gap:10px;
      align-items:center;
      flex-wrap:wrap;
      justify-content:flex-end;
    }

    .chip{
      font-size:12px;
      font-weight:800;
      border: 1px solid var(--line);
      background:#fff;
      border-radius: 999px;
      padding: 8px 10px;
      color: #111;
    }

    /* ===== Grid ===== */
    .wrap{
      max-width: var(--max);
      margin: 0 auto;
      padding: 14px 16px 40px;
    }

    .catalogo{
      display:grid;
      grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));
      gap: 18px;
      align-items:stretch;
    }

    .card{
      background: var(--card);
      border-radius: var(--radius);
      overflow:hidden;
      box-shadow: var(--shadow);
      border: 1px solid rgba(234,236,240,.9);
      display:flex;
      flex-direction:column;
      transition: transform .18s ease, box-shadow .18s ease;
    }
    .card:hover{
      transform: translateY(-3px);
      box-shadow: var(--shadow2);
    }

    .carousel{
      position:relative;
      width:100%;
      height: 230px;
      overflow:hidden;
      flex: 0 0 230px;
      background:#eef2f6;
      cursor: zoom-in;
    }

    .carousel img{
      width:100%;
      height: 230px;
      object-fit: cover;
      display:none;
      user-select:none;
      -webkit-user-drag:none;
    }
    .carousel img.active{ display:block; }

    .carousel button{
      position:absolute;
      top:50%;
      transform:translateY(-50%);
      background: rgba(17,17,17,.55);
      color:#fff;
      border:none;
      width: 36px;
      height: 36px;
      cursor:pointer;
      border-radius: 999px;
      z-index:2;
      display:grid;
      place-items:center;
      transition: background .12s ease, transform .12s ease;
    }
    .carousel button:hover{
      background: rgba(17,17,17,.75);
      transform: translateY(-50%) scale(1.03);
    }
    .prev{ left: 10px; }
    .next{ right: 10px; }

    .info{
      padding: 14px 14px 16px;
      display:flex;
      flex-direction:column;
      gap: 10px;
    }

    .topline{
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap: 10px;
    }

    .info h3{
      margin:0;
      font-size: 14px;
      line-height: 1.25;
      letter-spacing:.1px;
      font-weight: 850;
      text-transform: uppercase;
    }

    /* ‚úÖ PRECIOS EN NEGRO */
    .precio{
      color: #000;         /* antes var(--accent2) */
      font-weight: 900;
      white-space:nowrap;
      font-size: 14px;
    }

    .meta{
      display:flex;
      gap: 8px;
      flex-wrap:wrap;
      margin-top: -2px;
    }

    .tag{
      font-size: 11px;
      font-weight: 800;
      color: #111;
      background: #f2f4f7;
      border: 1px solid var(--line);
      border-radius: 999px;
      padding: 6px 8px;
    }

    .actions{
      display:flex;
      gap:10px;
      margin-top: 4px;
    }

    .btn{
      flex:1 1 auto;
      border:none;
      border-radius: 12px;
      padding: 11px 12px;
      cursor:pointer;
      font-weight: 900;
      letter-spacing:.2px;
      transition: transform .12s ease, opacity .12s ease, box-shadow .12s ease;
      display:flex;
      align-items:center;
      justify-content:center;
      gap: 8px;
      text-decoration:none;
      user-select:none;
    }

    .btn:active{ transform: scale(.99); }
    .btn-primary{
      background: var(--accent);
      color:#fff;
      box-shadow: 0 10px 22px rgba(17,17,17,.18);
    }
    .btn-primary:hover{ opacity: .95; }

    .btn-outline{
      background:#fff;
      color:#111;
      border: 1px solid var(--line);
    }
    .btn-outline:hover{ box-shadow: 0 10px 22px rgba(16,24,40,.08); transform: translateY(-1px); }

    .footer-actions{
      display:flex;
      justify-content:center;
      padding: 18px 0 0;
    }
    .loadmore{ min-width: 220px; }

    /* ===== LIGHTBOX (scroll + zoom + drag) ===== */
    .lightbox{
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,.72);
      backdrop-filter: blur(2px);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 999;
      padding: 18px;
    }
    .lightbox.show{ display:flex; }

    .lightbox-panel{
      width: min(980px, 96vw);
      height: min(720px, 86vh);
      background: rgba(17,17,17,.55);
      border: 1px solid rgba(255,255,255,.10);
      border-radius: 18px;
      box-shadow: 0 18px 60px rgba(0,0,0,.35);
      position: relative;
      overflow: hidden;
      display:flex;
      flex-direction: column;
    }

    .lightbox-top{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 10px;
      padding: 10px 12px;
      color: #fff;
      font-weight: 800;
      background: rgba(0,0,0,.25);
      border-bottom: 1px solid rgba(255,255,255,.08);
    }

    .lightbox-title{
      font-size: 13px;
      color: rgba(255,255,255,.92);
      overflow:hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
      max-width: 55%;
    }

    .lightbox-controls{
      display:flex;
      align-items:center;
      gap: 8px;
      flex-wrap: wrap;
      justify-content:flex-end;
    }

    .lb-btn{
      border:none;
      background: rgba(255,255,255,.12);
      color:#fff;
      padding: 8px 10px;
      border-radius: 999px;
      cursor:pointer;
      font-weight: 900;
      font-size: 12px;
      transition: transform .12s ease, background .12s ease;
      user-select:none;
    }
    .lb-btn:hover{ background: rgba(255,255,255,.18); transform: scale(1.02); }

    .lightbox-close{
      border:none;
      background: rgba(255,255,255,.12);
      color:#fff;
      width: 36px;
      height: 36px;
      border-radius: 999px;
      cursor:pointer;
      font-size: 18px;
      line-height: 0;
      display:grid;
      place-items:center;
      transition: transform .12s ease, background .12s ease;
    }
    .lightbox-close:hover{ background: rgba(255,255,255,.18); transform: scale(1.03); }

    .lightbox-body{
      position: relative;
      flex: 1 1 auto;
      padding: 12px;
      overflow: auto;
      overscroll-behavior: contain;
      background: rgba(0,0,0,.08);
    }

    .lightbox-stage{
      position: relative;
      width: max-content;
      height: max-content;
      min-width: 100%;
      min-height: 100%;
      display:flex;
      align-items:center;
      justify-content:center;
      padding: 10px;
    }

    .lightbox-img{
      max-width: 100%;
      max-height: 100%;
      object-fit: contain;
      border-radius: 14px;
      background: rgba(255,255,255,.04);
      transform-origin: center center;
      transform: translate(0px, 0px) scale(1);
      transition: transform .06s linear;
      user-select:none;
      -webkit-user-drag:none;
      cursor: grab;
      pointer-events: auto;
    }
    .lightbox-img:active{ cursor: grabbing; }

    .lightbox-nav{
      position:absolute;
      top:50%;
      transform: translateY(-50%);
      border:none;
      width: 46px;
      height: 46px;
      border-radius: 999px;
      cursor:pointer;
      background: rgba(0,0,0,.35);
      color:#fff;
      font-size: 22px;
      display:grid;
      place-items:center;
      transition: background .12s ease, transform .12s ease, opacity .12s ease;
      opacity: .95;
      z-index: 5;
    }
    .lightbox-nav:hover{ background: rgba(0,0,0,.52); transform: translateY(-50%) scale(1.03); }
    .lightbox-prev{ left: 12px; }
    .lightbox-next{ right: 12px; }

    .lightbox-footer{
      padding: 10px 12px 12px;
      color: rgba(255,255,255,.85);
      font-size: 12px;
      font-weight: 700;
      display:flex;
      justify-content:space-between;
      gap: 10px;
      background: rgba(0,0,0,.22);
      border-top: 1px solid rgba(255,255,255,.08);
      flex-wrap: wrap;
    }
    .lightbox-hint{ color: rgba(255,255,255,.70); font-weight: 650; }

    @media (max-width: 720px){
      .tools{ width: 56vw; }
      .hero{ align-items:flex-start; flex-direction:column; }
      .hero-right{ justify-content:flex-start; }
      .logo{ width:52px; height:52px; border-radius: 16px; }
    }
  </style>
</head>

<body>
  <!-- TOPBAR -->
  <div class="topbar">
    <div class="topbar-inner">
      <a class="brand" href="#">
        <div class="logo" id="brandLogo">
          <img src="https://lh3.googleusercontent.com/d/1pllXeSAeOcbq6w_h9Tuub6uYaysL77IV" alt="Logo NAra" />
        </div>

        <div>
          <h1>NAra</h1>
          <span>Cat√°logo oficial</span>
        </div>
      </a>

      <div class="tools">
        <div class="search" title="Buscar por nombre">
          <!-- ‚úÖ Reemplazo del emoji por PNG (cambia el link cuando quieras) -->
          <img
            class="search-icon"
            src="https://lh3.googleusercontent.com/d/1Y0pPOOOGWfMnjwYuo2N7G3a3fDA1pye6"
            alt="Buscar"
          />
          <input id="searchInput" type="text" placeholder="Buscar gorras..." />
        </div>
      </div>
    </div>
  </div>

  <!-- HERO -->
  <div class="hero">
    <div>
      <h2>Explora el cat√°logo</h2>
      <p>Compra directo por WhatsApp.</p>
    </div>
    <div class="hero-right">
      <span class="chip" id="countChip">0 productos</span>
      <span class="chip">Env√≠os üá®üá¥</span>
      <span class="chip">Pago contraentrega</span>
    </div>
  </div>

  <div class="wrap">
    <div class="catalogo" id="catalogo"></div>

    <div class="footer-actions">
      <button class="btn btn-outline loadmore" id="loadMoreBtn" type="button">
        Ver m√°s
      </button>
    </div>
  </div>

  <!-- LIGHTBOX -->
  <div class="lightbox" id="lightbox" aria-hidden="true">
    <div class="lightbox-panel" role="dialog" aria-modal="true" aria-label="Vista previa de imagen">
      <div class="lightbox-top">
        <div class="lightbox-title" id="lightboxTitle">Vista previa</div>

        <div class="lightbox-controls">
          <button class="lb-btn" id="zoomOutBtn" type="button">‚àí</button>
          <button class="lb-btn" id="zoomResetBtn" type="button">100%</button>
          <button class="lb-btn" id="zoomInBtn" type="button">+</button>
          <button class="lightbox-close" id="lightboxClose" type="button" aria-label="Cerrar">‚úï</button>
        </div>
      </div>

      <div class="lightbox-body" id="lightboxBody">
        <button class="lightbox-nav lightbox-prev" id="lightboxPrev" type="button" aria-label="Anterior">‚Äπ</button>

        <div class="lightbox-stage" id="lightboxStage">
          <img class="lightbox-img" id="lightboxImg" alt="Imagen ampliada" />
        </div>

        <button class="lightbox-nav lightbox-next" id="lightboxNext" type="button" aria-label="Siguiente">‚Ä∫</button>
      </div>

      <div class="lightbox-footer">
        <div id="lightboxCounter">1 / 1</div>
        <div class="lightbox-hint">Rueda: zoom ¬∑ Arrastra: mover ¬∑ Esc: cerrar ¬∑ ‚Üê ‚Üí: navegar</div>
      </div>
    </div>
  </div>

  <script>
    // üîó CONFIGURA TU SHEET
    const SHEET_ID = "1zzLV5JfDDzFJb6IkmEB_yrpz0p2d7TfTD5MppYi2tnY";
    const SHEET_NAME = "Hoja1";
    const JSON_URL = `https://opensheet.elk.sh/${SHEET_ID}/${SHEET_NAME}`;

    // WhatsApp
    const WHATSAPP_NUMBER = "573124124008";
    const whatsappLink = (text) =>
      `https://wa.me/${WHATSAPP_NUMBER}?text=${encodeURIComponent(text)}`;

    // Drive ID -> imagen
    function idToDriveImage(id) {
      return `https://lh3.googleusercontent.com/d/${id}`;
    }

    // Formatea precio si viene como n√∫mero (opcional)
    function formatPrice(value) {
      if (!value) return "";
      const raw = String(value).trim();
      if (/[a-zA-Z$]/.test(raw)) return raw;
      const num = Number(raw.replaceAll(".", "").replaceAll(",", "."));
      if (!Number.isFinite(num)) return raw;
      return num.toLocaleString("es-CO", { style: "currency", currency: "COP", maximumFractionDigits: 0 });
    }

    let productos = [];
    let filtered = [];
    let index = 0;
    const batchSize = 8;
    let isLoading = false;

    const contenedor = document.getElementById("catalogo");
    const loadMoreBtn = document.getElementById("loadMoreBtn");
    const searchInput = document.getElementById("searchInput");
    const countChip = document.getElementById("countChip");

    // ===== LIGHTBOX (scroll + zoom + drag) =====
    const lightbox = document.getElementById("lightbox");
    const lightboxImg = document.getElementById("lightboxImg");
    const lightboxTitle = document.getElementById("lightboxTitle");
    const lightboxCounter = document.getElementById("lightboxCounter");
    const lightboxClose = document.getElementById("lightboxClose");
    const lightboxPrev = document.getElementById("lightboxPrev");
    const lightboxNext = document.getElementById("lightboxNext");
    const lightboxBody = document.getElementById("lightboxBody");

    const zoomInBtn = document.getElementById("zoomInBtn");
    const zoomOutBtn = document.getElementById("zoomOutBtn");
    const zoomResetBtn = document.getElementById("zoomResetBtn");

    let lbImages = [];
    let lbIndex = 0;
    let lbName = "";

    // zoom/pan state
    let scale = 1;
    const minScale = 1;
    const maxScale = 6;
    let tx = 0, ty = 0;

    // drag state
    let dragging = false;
    let startX = 0, startY = 0;
    let startTx = 0, startTy = 0;

    function clamp(n, a, b){ return Math.max(a, Math.min(b, n)); }

    function applyTransform(){
      lightboxImg.style.transform = `translate(${tx}px, ${ty}px) scale(${scale})`;
      zoomResetBtn.textContent = `${Math.round(scale * 100)}%`;
    }

    function resetTransform(){
      scale = 1;
      tx = 0; ty = 0;
      applyTransform();
    }

    function openLightbox(images, startIndex, productName){
      lbImages = images?.length ? images : ["https://via.placeholder.com/1200x800?text=Sin+imagen"];
      lbIndex = Math.max(0, Math.min(startIndex || 0, lbImages.length - 1));
      lbName = productName || "Vista previa";

      lightbox.classList.add("show");
      lightbox.setAttribute("aria-hidden", "false");
      document.body.style.overflow = "hidden";

      renderLightbox();
      resetTransform();
    }

    function closeLightbox(){
      lightbox.classList.remove("show");
      lightbox.setAttribute("aria-hidden", "true");
      document.body.style.overflow = "";
    }

    function renderLightbox(){
      const src = lbImages[lbIndex];
      lightboxImg.src = src;
      lightboxTitle.textContent = lbName;
      lightboxCounter.textContent = `${lbIndex + 1} / ${lbImages.length}`;

      const showNav = lbImages.length > 1;
      lightboxPrev.style.display = showNav ? "grid" : "none";
      lightboxNext.style.display = showNav ? "grid" : "none";
    }

    function lbPrev(){
      lbIndex = (lbIndex - 1 + lbImages.length) % lbImages.length;
      renderLightbox();
      resetTransform();
      lightboxBody.scrollTo({ top: 0, left: 0, behavior: "instant" });
    }
    function lbNext(){
      lbIndex = (lbIndex + 1) % lbImages.length;
      renderLightbox();
      resetTransform();
      lightboxBody.scrollTo({ top: 0, left: 0, behavior: "instant" });
    }

    lightboxClose.addEventListener("click", closeLightbox);
    lightboxPrev.addEventListener("click", lbPrev);
    lightboxNext.addEventListener("click", lbNext);

    lightbox.addEventListener("click", (e) => {
      if (e.target === lightbox) closeLightbox();
    });

    window.addEventListener("keydown", (e) => {
      if (!lightbox.classList.contains("show")) return;
      if (e.key === "Escape") closeLightbox();
      if (e.key === "ArrowLeft") lbPrev();
      if (e.key === "ArrowRight") lbNext();
      if (e.key === "+" || e.key === "=") zoomBy(1.12);
      if (e.key === "-" || e.key === "_") zoomBy(1/1.12);
      if (e.key.toLowerCase() === "r") resetTransform();
    });

    function zoomBy(factor, centerClientX=null, centerClientY=null){
      const prevScale = scale;
      scale = clamp(scale * factor, minScale, maxScale);

      if (centerClientX !== null && centerClientY !== null){
        const rect = lightboxBody.getBoundingClientRect();
        const cx = centerClientX - rect.left - rect.width / 2;
        const cy = centerClientY - rect.top - rect.height / 2;
        const k = (scale / prevScale) - 1;
        tx -= cx * k;
        ty -= cy * k;
      }

      if (scale === 1){ tx = 0; ty = 0; }
      applyTransform();
    }

    zoomInBtn.addEventListener("click", () => zoomBy(1.15));
    zoomOutBtn.addEventListener("click", () => zoomBy(1/1.15));
    zoomResetBtn.addEventListener("click", resetTransform);

    lightboxBody.addEventListener("wheel", (e) => {
      if (!lightbox.classList.contains("show")) return;
      e.preventDefault();
      const factor = e.deltaY > 0 ? (1/1.12) : 1.12;
      zoomBy(factor, e.clientX, e.clientY);
    }, { passive: false });

    lightboxImg.addEventListener("mousedown", (e) => {
      if (!lightbox.classList.contains("show")) return;
      e.preventDefault();
      dragging = true;
      startX = e.clientX;
      startY = e.clientY;
      startTx = tx;
      startTy = ty;
    });

    window.addEventListener("mousemove", (e) => {
      if (!dragging) return;
      const dx = e.clientX - startX;
      const dy = e.clientY - startY;
      tx = startTx + dx;
      ty = startTy + dy;
      applyTransform();
    });

    window.addEventListener("mouseup", () => { dragging = false; });

    // ===== Data load =====
    fetch(JSON_URL)
      .then(res => res.json())
      .then(data => {
        productos = data.map(p => ({
          nombre: (p.nombre || "Sin nombre").trim(),
          precio: formatPrice(p.precio || ""),
          imagenes: (p.imagenes || "")
            .split("|")
            .map(x => x.trim())
            .filter(x => x.length > 0)
            .map(id => idToDriveImage(id)),
        }));

        filtered = [...productos];
        updateCount();
        resetRender();
        asegurarScroll();
      })
      .catch(err => console.error("Error cargando JSON:", err));

    function updateCount(){
      countChip.textContent = `${filtered.length} producto${filtered.length === 1 ? "" : "s"}`;
    }

    function resetRender(){
      contenedor.innerHTML = "";
      index = 0;
      cargarMas();
    }

    function cargarMas() {
      if (isLoading) return;
      isLoading = true;

      for (let i = 0; i < batchSize && index < filtered.length; i++, index++) {
        const p = filtered[index];

        const card = document.createElement("div");
        card.className = "card";

        const carousel = document.createElement("div");
        carousel.className = "carousel";

        const imgsToRender = p.imagenes.length
          ? p.imagenes
          : ["https://via.placeholder.com/800x600?text=Sin+imagen"];

        imgsToRender.forEach((imgUrl, i) => {
          const img = document.createElement("img");
          img.src = imgUrl;
          img.loading = "lazy";
          img.alt = p.nombre;
          if (i === 0) img.classList.add("active");

          img.addEventListener("click", () => openLightbox(imgsToRender, i, p.nombre));
          carousel.appendChild(img);
        });

        let current = 0;
        const getImgs = () => carousel.querySelectorAll("img");

        if (imgsToRender.length > 1) {
          const prev = document.createElement("button");
          prev.className = "prev";
          prev.type = "button";
          prev.textContent = "‚Äπ";
          prev.onclick = () => {
            const imgs = getImgs();
            imgs[current].classList.remove("active");
            current = (current - 1 + imgs.length) % imgs.length;
            imgs[current].classList.add("active");
          };

          const next = document.createElement("button");
          next.className = "next";
          next.type = "button";
          next.textContent = "‚Ä∫";
          next.onclick = () => {
            const imgs = getImgs();
            imgs[current].classList.remove("active");
            current = (current + 1) % imgs.length;
            imgs[current].classList.add("active");
          };

          carousel.appendChild(prev);
          carousel.appendChild(next);
        }

        card.appendChild(carousel);

        const info = document.createElement("div");
        info.className = "info";

        const topline = document.createElement("div");
        topline.className = "topline";

        const h3 = document.createElement("h3");
        h3.textContent = p.nombre;

        const precio = document.createElement("div");
        precio.className = "precio";
        precio.textContent = p.precio;

        topline.appendChild(h3);
        topline.appendChild(precio);

        const meta = document.createElement("div");
        meta.className = "meta";

        const t1 = document.createElement("span");
        t1.className = "tag";
        t1.textContent = "Gorras";

        const t2 = document.createElement("span");
        t2.className = "tag";
        t2.textContent = "Nueva colecci√≥n";

        meta.appendChild(t1);
        meta.appendChild(t2);

        const actions = document.createElement("div");
        actions.className = "actions";

        const buy = document.createElement("a");
        buy.className = "btn btn-primary";
        buy.href = whatsappLink(`Hola! Quiero comprar esta gorra:\n\n‚Ä¢ ${p.nombre}\n‚Ä¢ Precio: ${p.precio || "N/A"}\n\n¬øMe confirmas disponibilidad y env√≠o?`);
        buy.target = "_blank";
        buy.rel = "noopener";
        buy.textContent = "Comprar por WhatsApp";

        const share = document.createElement("button");
        share.className = "btn btn-outline";
        share.type = "button";
        share.textContent = "Copiar info";
        share.onclick = async () => {
          const text = `${p.nombre} - ${p.precio || ""}`.trim();
          try{
            await navigator.clipboard.writeText(text);
            share.textContent = "Copiado ‚úÖ";
            setTimeout(()=> share.textContent = "Copiar info", 1200);
          }catch(e){
            alert("No se pudo copiar.");
          }
        };

        actions.appendChild(buy);
        actions.appendChild(share);

        info.appendChild(topline);
        info.appendChild(meta);
        info.appendChild(actions);

        card.appendChild(info);
        contenedor.appendChild(card);
      }

      isLoading = false;
      loadMoreBtn.style.display = (index >= filtered.length) ? "none" : "inline-flex";
    }

    function asegurarScroll() {
      while (index < filtered.length && document.body.scrollHeight <= window.innerHeight) {
        cargarMas();
      }
    }

    window.addEventListener("scroll", () => {
      if (window.innerHeight + window.scrollY >= document.body.offsetHeight - 200) {
        cargarMas();
      }
    });

    loadMoreBtn.addEventListener("click", () => cargarMas());

    function applySearch(){
      const q = (searchInput.value || "").trim().toLowerCase();
      filtered = q
        ? productos.filter(p => (p.nombre || "").toLowerCase().includes(q))
        : [...productos];

      updateCount();
      resetRender();
      asegurarScroll();
    }

    let t = null;
    searchInput.addEventListener("input", () => {
      clearTimeout(t);
      t = setTimeout(applySearch, 150);
    });
  </script>
</body>
</html>
